@{
    ViewBag.Title = "Thêm mới danh mục";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<script src="/Content/BackEnd/plugins/ckeditor/ckeditor.js"></script>
<script src="/Content/BackEnd/plugins/ckfinder/ckfinder.js"></script>
<script src="/Content/BackEnd/plugins/ckeditor/config.js"></script>
<script src="/AppJs/category.js"></script>
@using BIDV
@using BIDV.Common
@using BIDV.Model
@model bidv__category
@using (Html.BeginForm("Edit", "AdminCategory", FormMethod.Post, new { enctype = "multipart/form-data", id = "formcategory" }))
{
    @Html.HiddenFor(g => g.id)
    @Html.HiddenFor(g => g.created)
    <div class="row">
        <div class="col-md-12">
            <div class="box box-info">
                <div class="box-header with-border">
                    <h3 class="box-title">Thông tin chung</h3>
                </div>
                <!-- /.box-header -->
                <!-- form start -->
                <div class="form-horizontal">
                    <div class="box-body">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Tên danh mục</label>
                            <div class="col-sm-10">
                                @Html.TextBoxFor(g => g.title, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Loại danh mục</label>
                            <div class="col-sm-10">
                                <select class="form-control" name="type" id="type">
                                    <option value="">--Chọn danh mục--</option>
                                    <option value="@((int)Config.TypeCategory.LoaiThe)">Loại thẻ</option>
                                    <option value="@((int)Config.TypeCategory.TinTuc)">Tin tức</option>
                                    <option value="@((int)Config.TypeCategory.UuDai)">Ưu đãi</option>
                                    <option value="@((int)Config.TypeCategory.TinKhuyenMai)">Tin khuyến mại</option>
                                    <option value="@((int)Config.TypeCategory.Qa)">Câu hỏi thường gặp</option>
                                </select>
                                <script>
                                    $("#type").val(@Model.type);
                                </script>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="title_text" class="col-sm-2 control-label">Danh mục gốc</label>

                            <div class="col-sm-10">
                                <select id="parent_id" name="parent_id" class="form-control"></select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="title_text" class="col-sm-2 control-label">Sắp xếp</label>
                            <div class="col-sm-10">
                                @Html.TextBoxFor(g => g.weight, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Trạng thái</label>

                            <div class="col-sm-10">
                                <select id="status" name="status" class="form-control">
                                    <option value=""> --Chọn trạng thái-- </option>
                                    <option value="1">Hiện</option>
                                    <option value="0">Ẩn</option>
                                </select>
                                <script>
                                    $("#status").val(@Model.status);
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="box-body" id="inforOther">

    </div>
    
    <div class="row">
        <div class="col-md-12">
            <div class="box box-info">
                <div class="box-header with-border">
                    <h3 class="box-title">Ảnh</h3>
                </div>
                <!-- /.box-header -->
                <!-- form start -->
                <div class="form-horizontal">
                    <div class="box-body">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Ảnh con</label>
                            <div class="col-sm-10">
                                <input type="file" id="file-icon" name="fileicon" style="display: none">
                                <button type="button" style="margin-right: 89%" onclick="$('#file-icon').click();" class="btn btn-default"><i class="glyphicon glyphicon-folder-open"></i>&nbsp;&nbsp;Chọn File</button>
                                <img id="view-icon" style="margin-top: 10px;" src="/Content/FrontEnd/_img_server/siteInfo/@Model.icon" alt="" height="50" />
                                <input type="hidden" name="icon" id="icon" value="@Model.icon" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Ảnh banner</label>
                            <div class="col-sm-10">
                                <input type="file" id="file-banner" name="filebanner" style="display: none">
                                <button type="button" style="margin-right: 89%" onclick="$('#file-banner').click();" class="btn btn-default"><i class="glyphicon glyphicon-folder-open"></i>&nbsp;&nbsp;Chọn File</button>
                                <img id="view-banner" style="margin-top: 10px;" src="/Content/FrontEnd/_img_server/category/@HelperDateTime.DateTimeToyyyymmdd(Model.created.Value)/size1500/@Model.image" alt="" height="50" />
                                <input type="hidden" name="image" id="image" value="@Model.image" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Nút</label>
                            <div class="col-sm-10">
                                <textarea rows="5" class="form-control" name="nut">@Html.Raw(HttpUtility.HtmlDecode(Model.nut))</textarea>                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <label class="col-sm-2 control-label"></label>
        <div class="col-sm-10">
            <button type="submit" class="btn btn-primary">Cập nhật</button>
        </div>
    </div>
}
<script>
    $(document).ready(function () {
        CKEDITOR.replace("nut", {
            language: 'vi',
            filebrowserBrowseUrl: "/Content/BackEnd/plugins/ckfinder/ckfinder.html",
            filebrowserImageBrowseUrl: '/Content/BackEnd/plugins/ckfinder/ckfinder.html?Type=Images',
            filebrowserFlashBrowseUrl: '/Content/BackEnd/plugins/ckfinder/ckfinder.html?Type=Flash',
            height: 350
        });
        $.get("/AdminCategory/LoadFormEditByTypeCat?typeid=@Model.type&catid=@Model.id", function (res) {
            $("#inforOther").html(res);
        });
        $.get("/AdminCategory/GetCategoryByTypeCat?typeid=@Model.type &catid=@Model.id", function (res) {
            $("#parent_id").html(res);
            $("#parent_id").val(@Model.parent_id);
        });
        $("#type").change(function () {
            $.get("/AdminCategory/GetCategoryByTypeCat?typeid=" + $(this).val() + "&catid=@Model.id", function (res) {
                $("#parent_id").html(res);
            });
            $.get("/AdminCategory/LoadFormEditByTypeCat?typeid=" + $(this).val() + "&catid=@Model.id", function (res) {
                $("#inforOther").html(res);
            });
        });
        function readUrl(input, name) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#view-' + name).attr('src', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        $("#file-icon").change(function () {
            readUrl(this, 'icon');
        });
        $("#file-banner").change(function () {
            readUrl(this, 'banner');
        });
        category.validateForm();
    });
</script>
